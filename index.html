<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>DAK To-Do</title>

<link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;600&display=swap" rel="stylesheet">

<style>
  html, body {
    margin: 0;
    padding: 16px;
    background: transparent;
    font-family: 'Comfortaa', sans-serif;
    color: #ffffff;
  }

  h2 {
    margin-top: 0;
    font-size: 22px;
    font-weight: 600;
  }

  .list {
    margin-bottom: 18px;
  }

  .listTitle {
    font-size: 15px;
    opacity: 0.8;
    margin-bottom: 6px;
    text-transform: uppercase;
    letter-spacing: 0.06em;
  }

  ul {
    list-style: none;
    padding: 0;
    margin: 0 0 6px 0;
  }

  li {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 4px 0;
    font-size: 15px;
    cursor: grab;
  }

  li.done span {
    text-decoration: line-through;
    opacity: 0.5;
  }

  input[type="checkbox"] {
    width: 17px;
    height: 17px;
    accent-color: #ffffff;
  }

  .addLink {
    font-size: 14px;
    opacity: 0.8;
    cursor: pointer;
  }

  .addLink:hover {
    opacity: 1;
  }

  /* Drag target area */
  .dropZone {
    min-height: 10px;
  }
</style>
</head>

<body>
<h2>To-Dos</h2>

<div id="lists"></div>

<script>
const API_BASE = "https://script.google.com/macros/s/AKfycbxiEJYTarlrz6WS3Xy0vN4GfI9BOETheIvQV6y-ireSIrmw3GFs11afETn7ziv8nV6d/exec";  // <-- paste Apps Script URL

let CATEGORIES = ["This Week", "For Later"];
let tasks = [];

// Simple API wrappers
async function apiGet(action) {
  const res = await fetch(`${API_BASE}?action=${action}`);
  return res.json();
}

async function apiPost(action, data) {
  const res = await fetch(`${API_BASE}?action=${action}`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify(data || {})
  });
  return res.json();
}

async function loadTasks() {
  const data = await apiGet("list");
  tasks = data.tasks || [];
  render();
}

// Add task to specific category
async function addTask(category) {
  const text = prompt(`Add task to ${category}:`);
  if (!text) return;

  const data = await apiPost("add", { text, category });
  tasks = data.tasks;
  render();
}

// Toggle done/undone
async function toggleTask(id, checked) {
  const data = await apiPost("toggle", { id, done: checked });
  tasks = data.tasks;
  render();
}

// Move task (drag + drop)
async function moveTask(id, category) {
  const data = await apiPost("move", { id, category });
  tasks = data.tasks;
  render();
}

// Render UI
function render() {
  const container = document.getElementById("lists");
  container.innerHTML = "";

  CATEGORIES.forEach(cat => {
    const listDiv = document.createElement("div");
    listDiv.className = "list";

    const title = document.createElement("div");
    title.className = "listTitle";
    title.textContent = cat;
    listDiv.appendChild(title);

    const ul = document.createElement("ul");

    tasks
      .filter(t => t.category === cat)
      .forEach(t => {
        const li = document.createElement("li");
        li.draggable = true;

        if (t.done) li.classList.add("done");

        const cb = document.createElement("input");
        cb.type = "checkbox";
        cb.checked = t.done;
        cb.onchange = () => toggleTask(t.id, cb.checked);

        const text = document.createElement("span");
        text.textContent = t.text;

        // DRAG & DROP EVENTS
        li.addEventListener("dragstart", e => {
          e.dataTransfer.setData("text/plain", t.id);
        });

        ul.appendChild(li);
        li.appendChild(cb);
        li.appendChild(text);
      });

    // Drop zone for drag & drop reassigning
    const dropZone = document.createElement("div");
    dropZone.className = "dropZone";

    dropZone.addEventListener("dragover", e => e.preventDefault());
    dropZone.addEventListener("drop", e => {
      e.preventDefault();
      const id = e.dataTransfer.getData("text/plain");
      moveTask(id, cat);
    });

    listDiv.appendChild(ul);
    listDiv.appendChild(dropZone);

    // Add Task link
    const add = document.createElement("div");
    add.className = "addLink";
    add.textContent = "+ Add task";
    add.onclick = () => addTask(cat);
    listDiv.appendChild(add);

    container.appendChild(listDiv);
  });
}

loadTasks();
</script>
</body>
</html>
